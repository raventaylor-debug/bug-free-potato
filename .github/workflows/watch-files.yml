name: Slack notify (webhook)

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Post to Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          REPO: ${{ github.repository }}
          ACTOR: ${{ github.actor }}
          REF: ${{ github.ref_name }}
          SHA: ${{ github.sha }}
          RUN_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          COMMIT_URL: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}
        run: |
          set -euo pipefail

          text="Push to *${REPO}* on *${REF}* by *${ACTOR}*.\n• Commit: ${COMMIT_URL}\n• Run: ${RUN_URL}"

          payload="$(jq -n --arg text "$text" '{text: $text}')"

          curl -fsSL -X POST \
            -H 'Content-type: application/json' \
            --data "$payload" \
            "$SLACK_WEBHOOK_URL"